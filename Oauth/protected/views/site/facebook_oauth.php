<?php$user_id = Yii::app()->facebook->getUser();?><?phpif ($user_id) {    // 如果我們得到用戶FB的id, 有可能是用戶已登入, 如果不是    // 如果不是, 我們會得到一個異常, 下面是我們的處理    try {        Yii::app()->session['gottenAccessToken'] = Yii::app()->facebook->getAccessToken();        $user_profile = Yii::app()->facebook->api('/me?fields=id,name,first_name,last_name,gender,birthday,location,link,email,religion,education,work,relationship_status,family,about,hometown,friendlists.limit(10){name,id},likes.limit(10){about},groups.limit(5){name}'); //?fields=id,name,first_name,last_name,gender,link,email//        print_r($user_profile);        echo "------------------------------使用者基本資料------------------------------<br>";        echo "使用者ID" . $user_profile['id'] . "<br>";        echo "姓名: " . $user_profile['name'] . "<br>";        echo "姓:" . $user_profile['last_name'] . "<br>";        echo" 名:" . $user_profile['first_name'] . "<br>";        echo "大頭照: <img src='https://graph.facebook.com/$user_id/picture'><br>";        echo "性別:" . $user_profile['gender'] . "<br>";        echo "生日:" . $user_profile['birthday'] . "<br>";        echo "感情:" . $user_profile['relationship_status'] . "<br>";        echo "------------------------------使用者其他資訊------------------------------<br>";        echo "Facebook Link:" . $user_profile['link'] . "<br>";        echo "Email:" . $user_profile['email'] . "<br>";        echo "居住地:<br>";        echo "&nbsp&nbsp&nbsp" . $user_profile['location']['name'] . "<br>";        echo "教育:<br>";        if (!empty($user_profile['education'])) {            foreach ($user_profile['education'] as $key => $value) {                echo "&nbsp&nbsp&nbsp學校名稱:" . $value['school']['name'] . "<br>";                echo "&nbsp&nbsp&nbsp類別:" . $value['type'] . "<br>";                echo "---------------------------------------------" . "<br>";            }        }        echo "家人:<br>";        print_r($user_profile['family']);        if (!empty($user_profile['family'])) {            foreach ($user_profile['family']['data'] as $key => $value) {                echo "&nbsp&nbsp&nbsp姓名:" . $value['name'] . "<br>";                echo "&nbsp&nbsp&nbsp關係:" . $value['relationship'] . "<br>";                echo "---------------------------------------------" . "<br>";            }        }        echo "宗教:" . $user_profile['religion'] . "<br>";        echo "工作:<br>";        print_r($user_profile['work']);        if (!empty($user_profile['work'])) {            foreach ($user_profile['work'] as $key => $value) {                echo "&nbsp&nbsp&nbsp公司名稱:" . $value['employer']['name'] . "<br>";                echo "&nbsp&nbsp&nbsp公司地點:" . $value['location']['name'] . "<br>";                echo "&nbsp&nbsp&nbsp開始日期" . $value['start_date'] . "<br>";                echo "&nbsp&nbsp&nbsp結束日期" . $value['end_date'] . "<br>";                echo "---------------------------------------------" . "<br>";            }        }        echo "點過的讚:<br>";        if (!empty($user_profile['likes'])) {            foreach ($user_profile['likes']['data'] as $key => $value) {                echo "&nbsp&nbsp&nbspAbout:" . $value['about'] . "<br>";                echo "---------------------------------------------" . "<br>";            }        }        echo "加入的社團:<br>";        echo "&nbsp&nbsp&nbsp" . json_encode($user_profile['groups']) . "<br>";        echo "朋友列表:<br>";        echo "&nbsp&nbsp&nbsp" . json_encode($user_profile['friendlists']) . "<br>";        echo "-----------------------------------------------------------------";        //登出回傳網址        $logout_url = 'http://www.oauth.jowinwin.com/oauth/index.php?r=site/facebook_oauth';        $logout = Yii::app()->createUrl('site/FLogout', array('url' => $logout_url));        echo '<a href="' . $logout . '">登出</a>';    } catch (FacebookApiException $e) {        // 如果用戶已登出, 即使access token失效仍然可以得到用戶id,        // 這時候我們會得到一個異常, 並請用戶再次登入        Yii::app()->facebook->destroySession();        session_destroy();        $login_url = Yii::app()->facebook->getLoginUrl();        echo 'Please!!!! <a href="' . $login_url . '">login.</a>';        error_log($e->getType());        error_log($e->getMessage());    }} else {    // 沒有用戶的話, 給他一個登入的連結    $login_url = Yii::app()->facebook->getLoginUrl();    echo 'Please <a class="various" href="' . $login_url . '">login.</a>'; //href="' . $login_url . '"}?><script src="http://code.jquery.com/jquery-1.11.3.min.js"></script><link rel="stylesheet" href="<?php echo Yii::app()->request->baseUrl; ?>/js/source/jquery.fancybox.css?v=2.1.6" type="text/css" media="screen" /><script type="text/javascript" src="<?php echo Yii::app()->request->baseUrl; ?>/js/source/jquery.fancybox.pack.js?v=2.1.6"></script><script>//$(document).ready(function() {//	$(".various").fancybox({//		maxWidth	: 800,//		maxHeight	: 600,//		fitToView	: false,//		width		: '70%',//		height		: '70%',//		autoSize	: false,//		closeClick	: false,//		openEffect	: 'none',//		closeEffect	: 'none'//	});//});</script>